#!/bin/bash

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CDN é˜²å¾¡ç³»ç»Ÿ - Docker é•œåƒé¢„æ„å»ºè„šæœ¬
# æ­¤è„šæœ¬é¢„å…ˆæ„å»ºæ‰€æœ‰æ‰€éœ€çš„ Docker é•œåƒï¼ŒåŠ é€Ÿéƒ¨ç½²
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

cd "$(dirname "$0")"

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                       â•‘"
echo "â•‘           CDN é˜²å¾¡ç³»ç»Ÿ - Docker é•œåƒé¢„æ„å»º                           â•‘"
echo "â•‘                                                                       â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ£€æŸ¥ Docker
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if ! command -v docker &> /dev/null; then
    echo "âŒ Docker æœªå®‰è£…"
    exit 1
fi

echo "âœ… Docker å·²å°±ç»ª: $(docker --version)"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç¬¬ 1 æ­¥ï¼šæ„å»º Django åº”ç”¨é•œåƒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "ğŸ”¨ ç¬¬ 1 æ­¥ï¼šæ„å»º Django åº”ç”¨é•œåƒ..."
echo "   æ ‡ç­¾: cdn-defense:django-latest"
echo ""

docker build \
    -f docker/Dockerfile.django \
    -t cdn-defense:django-latest \
    -t cdn-defense:django-v1 \
    --progress=plain \
    .

echo ""
echo "âœ… Django é•œåƒæ„å»ºå®Œæˆ"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç¬¬ 2 æ­¥ï¼šæ„å»ºé˜²å¾¡ API é•œåƒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "ğŸ”¨ ç¬¬ 2 æ­¥ï¼šæ„å»ºé˜²å¾¡ API é•œåƒ..."
echo "   æ ‡ç­¾: cdn-defense:api-latest"
echo ""

docker build \
    -f docker/Dockerfile.defense-api \
    -t cdn-defense:api-latest \
    -t cdn-defense:api-v1 \
    --progress=plain \
    .

echo ""
echo "âœ… é˜²å¾¡ API é•œåƒæ„å»ºå®Œæˆ"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç¬¬ 3 æ­¥ï¼šæ˜¾ç¤ºæ„å»ºç»“æœ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "ğŸ“Š å·²æ„å»ºçš„é•œåƒ:"
echo ""
docker images | grep "cdn-defense" || echo "âŒ æœªæ‰¾åˆ°é•œåƒ"

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                       â•‘"
echo "â•‘                   âœ… é•œåƒæ„å»ºå®Œæˆï¼                                    â•‘"
echo "â•‘                                                                       â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ“ ä¸‹ä¸€æ­¥ï¼š"
echo "   1. ä¿®æ”¹ docker-compose.yml ä½¿ç”¨è‡ªå®šä¹‰é•œåƒ:"
echo "      â€¢ django-api ä½¿ç”¨: cdn-defense:django-latest"
echo "      â€¢ defense-api ä½¿ç”¨: cdn-defense:api-latest"
echo ""
echo "   2. å¯åŠ¨å®¹å™¨:"
echo "      cd docker && ~/docker-compose up -d"
echo ""
echo "ğŸ’¡ æŸ¥çœ‹é•œåƒè¯¦æƒ…:"
echo "   docker image inspect cdn-defense:django-latest"
echo "   docker image inspect cdn-defense:api-latest"
echo ""
echo "ğŸ—‘ï¸ åˆ é™¤é•œåƒ:"
echo "   docker image rm cdn-defense:django-latest cdn-defense:api-latest"
echo ""

