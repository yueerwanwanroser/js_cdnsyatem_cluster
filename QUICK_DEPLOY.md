# ğŸš€ CDN é˜²å¾¡ç³»ç»Ÿ - ä¸€ç«™å¼å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“Œ æ¦‚è¿°

`deploy-all-in-one.sh` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸€ç«™å¼éƒ¨ç½²è„šæœ¬ï¼Œé›†ä»¥ä¸‹åŠŸèƒ½äºä¸€ä½“ï¼š

âœ… **è‡ªåŠ¨å®‰è£… Docker**
âœ… **è‡ªåŠ¨å®‰è£… Docker Compose**
âœ… **è‡ªåŠ¨æ„å»º Django é•œåƒ**
âœ… **è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰å®¹å™¨**
âœ… **è‡ªåŠ¨éªŒè¯éƒ¨ç½²çŠ¶æ€**

## âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆä»…éœ€ä¸€è¡Œå‘½ä»¤ï¼‰

### æ–¹å¼ 1: ç›´æ¥è¿è¡Œè„šæœ¬

```bash
cd /home/alana/cdn-defense-system
bash deploy-all-in-one.sh
```

### æ–¹å¼ 2: åå°è¿è¡Œï¼ˆæ¨èç”¨äºäº‘æœåŠ¡å™¨ï¼‰

```bash
cd /home/alana/cdn-defense-system
nohup bash deploy-all-in-one.sh > deployment.log 2>&1 &

# ç›‘æ§éƒ¨ç½²è¿›åº¦
tail -f deployment.log
```

## ğŸ“Š è„šæœ¬æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ 1 æ­¥: æ£€æŸ¥/å®‰è£… Docker                                  â”‚
â”‚  â€¢ æ£€æµ‹ Docker æ˜¯å¦å·²å®‰è£…                                    â”‚
â”‚  â€¢ å¦‚æœæœªå®‰è£…ï¼Œè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…                                â”‚
â”‚  â€¢ å¯åŠ¨ Docker daemon                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 2 æ­¥: æ£€æŸ¥/å®‰è£… Docker Compose                           â”‚
â”‚  â€¢ æ£€æµ‹ Docker Compose æ˜¯å¦å·²å®‰è£…                            â”‚
â”‚  â€¢ æ”¯æŒ v1 å’Œ v2 ç‰ˆæœ¬                                        â”‚
â”‚  â€¢ å¦‚æœæœªå®‰è£…ï¼Œè‡ªåŠ¨ä¸‹è½½å®‰è£…                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 3 æ­¥: æ„å»º Django é•œåƒ                                   â”‚
â”‚  â€¢ æ£€æŸ¥é•œåƒæ˜¯å¦å·²å­˜åœ¨                                        â”‚
â”‚  â€¢ å¦‚æœå­˜åœ¨ï¼Œè·³è¿‡æ„å»º                                        â”‚
â”‚  â€¢ å¦‚æœä¸å­˜åœ¨ï¼Œè‡ªåŠ¨æ„å»º (5-15 åˆ†é’Ÿ)                         â”‚
â”‚  â€¢ é•œåƒå¤§å°: ~493MB                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 4 æ­¥: å¯åŠ¨æ‰€æœ‰å®¹å™¨                                       â”‚
â”‚  â€¢ PostgreSQL (æ•°æ®åº“)                                       â”‚
â”‚  â€¢ Redis (ç¼“å­˜)                                             â”‚
â”‚  â€¢ etcd (é…ç½®ä¸­å¿ƒ)                                          â”‚
â”‚  â€¢ Django API (åº”ç”¨)                                        â”‚
â”‚  â€¢ Prometheus (ç›‘æ§é‡‡é›†)                                     â”‚
â”‚  â€¢ Grafana (ç›‘æ§é¢æ¿)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 5 æ­¥: éªŒè¯éƒ¨ç½²çŠ¶æ€                                       â”‚
â”‚  â€¢ æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨è¿è¡ŒçŠ¶æ€                                      â”‚
â”‚  â€¢ æ£€æŸ¥ Django æœåŠ¡æ—¥å¿—                                      â”‚
â”‚  â€¢ æ˜¾ç¤ºè®¿é—®åœ°å€å’Œç™»å½•å‡­è¯                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## â±ï¸ é¢„è®¡è€—æ—¶

| é˜¶æ®µ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| å®‰è£… Docker | 1-3 åˆ†é’Ÿ | é¦–æ¬¡å®‰è£…éœ€è¦ä¸‹è½½ |
| å®‰è£… Compose | 1-2 åˆ†é’Ÿ | é¦–æ¬¡å®‰è£…éœ€è¦ä¸‹è½½ |
| æ„å»ºé•œåƒ | 5-15 åˆ†é’Ÿ | é¦–æ¬¡æ„å»ºéœ€è¦ç¼–è¯‘ Python ä¾èµ– |
| å¯åŠ¨å®¹å™¨ | 1-3 åˆ†é’Ÿ | æ‹‰å–åŸºç¡€é•œåƒå’Œå¯åŠ¨æœåŠ¡ |
| **æ€»è®¡** | **10-30 åˆ†é’Ÿ** | é¦–æ¬¡å®Œæ•´éƒ¨ç½² |

**åç»­éƒ¨ç½²** (é•œåƒå·²å­˜åœ¨): **2-5 åˆ†é’Ÿ**

## ğŸ“ è„šæœ¬åŠŸèƒ½è¯¦è§£

### 1ï¸âƒ£ Docker å®‰è£…ä¸æ£€æŸ¥

```bash
# è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œ:
if command -v docker &> /dev/null; then
    # Docker å·²å®‰è£…ï¼Œæ˜¾ç¤ºç‰ˆæœ¬
else
    # ä¸‹è½½å¹¶å®‰è£… Docker
    curl -fsSL https://get.docker.com | bash
fi
```

### 2ï¸âƒ£ Docker Compose å®‰è£…ä¸æ£€æŸ¥

```bash
# è„šæœ¬æ”¯æŒå¤šç§å®‰è£…æ–¹å¼:
# - æ£€æŸ¥ docker-compose å‘½ä»¤
# - æ£€æŸ¥ docker compose (v2) æ’ä»¶
# - å¦‚æœéƒ½ä¸å­˜åœ¨ï¼Œä» GitHub ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
```

### 3ï¸âƒ£ é•œåƒæ„å»º

```bash
# ä»…åœ¨é•œåƒä¸å­˜åœ¨æ—¶æ„å»º
docker build \
    -f docker/Dockerfile.django \
    -t cdn-defense:django-latest \
    -t cdn-defense:django-v1 \
    .
```

### 4ï¸âƒ£ å®¹å™¨å¯åŠ¨

è‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨ä»¥ä¸‹å®¹å™¨ï¼š

- **postgresql:15-alpine** - æ•°æ®åº“
- **redis:7-alpine** - ç¼“å­˜ç³»ç»Ÿ
- **etcd:v3.5.7** - é…ç½®ä¸­å¿ƒ
- **cdn-defense:django-latest** - Django API
- **prometheus** - ç›‘æ§é‡‡é›†
- **grafana** - ç›‘æ§é¢æ¿

æ‰€æœ‰å®¹å™¨ä½¿ç”¨è‡ªå®šä¹‰ Docker ç½‘ç»œ (`cdn-network`)ï¼Œæ”¯æŒç›¸äº’é€šä¿¡ã€‚

### 5ï¸âƒ£ éªŒè¯ä¸è¾“å‡º

è„šæœ¬ä¼šæ˜¾ç¤ºï¼š
- æ‰€æœ‰å®¹å™¨çš„è¿è¡ŒçŠ¶æ€
- Django API çš„å¯åŠ¨æ—¥å¿—
- å„æœåŠ¡çš„è®¿é—®åœ°å€å’Œç™»å½•å‡­è¯

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

| æœåŠ¡ | åœ°å€ | ç™»å½•å‡­è¯ |
|------|------|--------|
| å‰ç«¯ | http://localhost | - |
| Django API | http://localhost:8000 | - |
| Django Admin | http://localhost:8000/admin/ | admin / admin123 |
| API æ–‡æ¡£ | http://localhost:8000/api/docs/ | - |
| Grafana | http://localhost:3000 | admin / grafana123 |
| Prometheus | http://localhost:9090 | - |
| PostgreSQL | localhost:5432 | cdnuser / cdnpass123 |
| Redis | localhost:6379 | (ä½¿ç”¨å¯†ç : redispass123) |
| etcd | localhost:2379 | - |

## ğŸ¯ é«˜äº®æé†’

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹æ–¹å¼çªå‡ºé‡è¦ä¿¡æ¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  é‡è¦æé†’                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‡è¦çš„æ“ä½œæˆ–è­¦å‘Šä¼šæ˜¾ç¤ºåœ¨çº¢è‰²æ¡†ä¸­      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å…³é”®æé†’åŒ…æ‹¬ï¼š
- âš ï¸ æ­£åœ¨å®‰è£…çš„è½¯ä»¶
- âš ï¸ æ­£åœ¨æ„å»ºçš„é•œåƒ
- âš ï¸ é‡è¦çš„æ“ä½œæ­¥éª¤
- âš ï¸ é¦–æ¬¡ä½¿ç”¨éœ€è¦ä¿®æ”¹å¯†ç 

## ğŸ“– å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
docker ps -a
docker ps  # ä»…æ˜¾ç¤ºè¿è¡Œä¸­çš„å®¹å™¨
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹ Django åº”ç”¨æ—¥å¿—
docker logs -f cdn-django-api

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker logs -f cdn-postgres

# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker logs -f
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯å•ä¸ªå®¹å™¨
docker restart cdn-django-api

# é‡å¯æ‰€æœ‰å®¹å™¨
docker-compose -f docker/docker-compose-deploy.yml restart
```

### åœæ­¢ç³»ç»Ÿ

```bash
# åœæ­¢æ‰€æœ‰å®¹å™¨
docker-compose -f docker/docker-compose-deploy.yml down

# åœæ­¢å¹¶åˆ é™¤ volume (è°¨æ…æ“ä½œï¼Œä¼šåˆ é™¤æ•°æ®)
docker-compose -f docker/docker-compose-deploy.yml down -v
```

### æ¸…ç†èµ„æº

```bash
# åˆ é™¤æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -a

# åˆ é™¤æœªä½¿ç”¨çš„ volume
docker volume prune
```

### é‡æ–°æ„å»ºé•œåƒ

```bash
# åˆ é™¤æ—§é•œåƒ
docker image rm cdn-defense:django-latest cdn-defense:django-v1

# é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy-all-in-one.sh
```

## âš™ï¸ æ•…éšœæ’é™¤

### é—®é¢˜ 1: Docker æƒé™é”™è¯¯

```
Error: permission denied while trying to connect to Docker daemon
```

**è§£å†³æ–¹æ¡ˆ:**

```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–è¿è¡Œ
newgrp docker
```

### é—®é¢˜ 2: ç«¯å£è¢«å ç”¨

```
Error: port 8000 is already allocated
```

**è§£å†³æ–¹æ¡ˆ:**

1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   ```bash
   lsof -i :8000
   ```

2. ä¿®æ”¹ docker-compose-deploy.yml ä¸­çš„ç«¯å£æ˜ å°„
   ```yaml
   ports:
     - "8001:8000"  # æ”¹ä¸º 8001
   ```

3. é‡å¯å®¹å™¨
   ```bash
   docker-compose -f docker/docker-compose-deploy.yml restart
   ```

### é—®é¢˜ 3: ç£ç›˜ç©ºé—´ä¸è¶³

```
Error: no space left on device
```

**è§£å†³æ–¹æ¡ˆ:**

```bash
# æ¸…ç† Docker èµ„æº
docker system prune -a

# åˆ é™¤ä¸éœ€è¦çš„é•œåƒ
docker image ls  # åˆ—å‡ºæ‰€æœ‰é•œåƒ
docker image rm <image-id>  # åˆ é™¤æŒ‡å®šé•œåƒ

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h
```

### é—®é¢˜ 4: å®¹å™¨æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ:**

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs <container-name>

# æ£€æŸ¥å®¹å™¨é…ç½®
docker inspect <container-name>

# é‡æ–°å¯åŠ¨å®¹å™¨
docker restart <container-name>

# å¦‚æœä»ç„¶å¤±è´¥ï¼Œåˆ é™¤å®¹å™¨å¹¶é‡æ–°å¯åŠ¨
docker rm <container-name>
docker-compose -f docker/docker-compose-deploy.yml up -d
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **æ›´æ”¹é»˜è®¤å¯†ç **
   ```
   Django Admin: http://localhost:8000/admin/
   Grafana: http://localhost:3000
   ```

2. **é…ç½®é˜²ç«å¢™**
   ```bash
   # ä»…å…è®¸æœ¬åœ°è®¿é—®
   sudo ufw allow from 127.0.0.1 to any port 8000
   sudo ufw allow from 127.0.0.1 to any port 3000
   ```

3. **å®šæœŸå¤‡ä»½æ•°æ®**
   ```bash
   # å¤‡ä»½ PostgreSQL æ•°æ®
   docker exec cdn-postgres pg_dump -U cdnuser cdn_defense > backup.sql
   ```

4. **æ›´æ–°é•œåƒ**
   ```bash
   docker pull postgres:15-alpine
   docker pull redis:7-alpine
   # é‡æ–°æ„å»ºåº”ç”¨é•œåƒ
   bash deploy-all-in-one.sh
   ```

## ğŸ“ è·å–å¸®åŠ©

| é—®é¢˜ | æ–‡ä»¶ |
|------|------|
| ç³»ç»Ÿæ¶æ„ | README.md |
| Django é…ç½® | DJANGO_QUICKSTART.md |
| Docker é…ç½® | CONTAINER_DEPLOYMENT.md |
| éƒ¨ç½²ç»†èŠ‚ | DEPLOYMENT_SUMMARY.md |

## âœ¨ å®Œæˆæ ‡å¿—

è„šæœ¬æˆåŠŸå®Œæˆæ—¶ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              âœ… éƒ¨ç½²å®Œæˆï¼                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â•”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           ğŸ‰ ç³»ç»Ÿå·²å¯åŠ¨                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ­¤æ—¶æ‰€æœ‰å®¹å™¨å·²è¿è¡Œï¼Œç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼

---

**æœ€åæ›´æ–°**: 2025-11-30
**é€‚ç”¨ç‰ˆæœ¬**: æ‰€æœ‰ Linux ç³»ç»Ÿ (Ubuntu, Debian, CentOS ç­‰)
**é¢„æœŸæˆåŠŸç‡**: 95%+ (å–å†³äºç½‘ç»œå’Œç³»ç»Ÿé…ç½®)
